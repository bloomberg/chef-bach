################################################
#
#              Generated by Chef
#
################################################

[DEFAULT]
# XXX: The following is a work-around to allow any cinder process
#      to serve any volume (since they're RBD backed)
host = bcpc
storage_availability_zone=<%="#{node[:bcpc][:region_name]}"%>
rootwrap_config = /etc/cinder/rootwrap.conf
api_paste_confg = /etc/cinder/api-paste.ini
verbose = False
debug = False
auth_strategy = keystone
state_path = /var/lib/cinder
logdir=/var/log/cinder

# Bind to mgt IP only
osapi_volume_listen=<%="#{node[:bcpc][:management][:ip]}"%>

# MySQL Connection
sql_connection=mysql://<%="#{get_bcpc_config('mysql-cinder-user')}"%>:<%="#{get_bcpc_config('mysql-cinder-password')}"%>@<%="#{node[:bcpc][:management][:vip]}"%>/<%="#{node['bcpc']['cinder_dbname']}"%>
sql_idle_timeout=3600

# Rabbit message queue settings
rabbit_host=<%="#{node[:bcpc][:management][:vip]}"%>
rabbit_password=<%="#{get_bcpc_config('rabbitmq-password')}"%>
rabbit_ha_queues=False
rabbit_durable_queues=True

# If using qpid...
#rpc_backend=cinder.openstack.common.rpc.impl_qpid
#qpid_hostname=<%="#{node[:bcpc][:management][:vip]}"%>
#qpid_username=admin
#qpid_password=<%="#{get_bcpc_config('rabbitmq-password')}"%>

# Other service endpoints
glance_host=<%="#{node[:bcpc][:management][:vip]}"%>
glance_api_servers=<%="#{node[:bcpc][:management][:vip]}"%>:9292
glance_api_version=2

# Volume driver settings for RBD
enabled_backends=<%="#{node[:bcpc][:ceph][:enabled_pools].map {|type| type.upcase}.join(",")}"%>

<% node[:bcpc][:ceph][:enabled_pools].each do |type| -%>
[<%="#{type.upcase}"%>]
volume_driver=cinder.volume.drivers.rbd.RBDDriver
volume_backend_name=<%="#{type.upcase}"%>
rbd_user=admin
rbd_pool=<%="#{node[:bcpc][:ceph][:volumes][:name]}-#{type}"%>
rbd_secret_uuid=<%="#{get_bcpc_config('libvirt-secret-uuid')}"%>
<% end -%>
