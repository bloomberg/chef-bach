################################################
#
#              Generated by Chef
#
################################################

# default: on
# description: mysqlchk
service mysqlchk
{
# this is a config for xinetd, place it in /etc/xinetd.d/
        disable = no
        flags           = REUSE
        socket_type     = stream
        bind            = <%="#{node[:bcpc][:networks][node[:bcpc][:management][:subnet]][:management][:ip]}"%>
        port            = 3307
        wait            = no
        user            = nobody
        server          = /usr/bin/clustercheck
        server_args     = <%="#{get_config('mysql-check-user')}"%> <%="#{get_config('mysql-check-password')}"%> 1
        log_on_failure  += USERID
        only_from       = <%=(node[:bcpc][:networks].keys.map do |n|
                               node[:bcpc][:networks][n][:management][:cidr]
                             end + [node[:bcpc][:management][:vip]]).join(' ')
                           %>
        # recommended to put the IPs that need
        # to connect exclusively (security purposes)
        per_source      = UNLIMITED
}
